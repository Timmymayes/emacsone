#+Title: Emacs US Config
#+PROPERTY: header-args:emacs-lisp :tangle ~/Projects/emacsone/init.el



* Resume point


* Package Setup
#+begin_src emacs-lisp
  (require 'package)



  (setq package-archives '(("melpa" . "https://melpa.org/packages/")
                           ;;("org" . "https://orgmode.org/elpa/")
                           ("gnu" . "https://elpa.gnu.org/packages/")
                           ("nongnu" . "https://elpa.nongnu.org/nongnu/")

                           ("elpa" . "https://elpa.gnu.org/packages/")))

  (package-initialize)
  (assq-delete-all 'org package--builtins)
  (assq-delete-all 'org package--builtin-versions)
  (unless package-archive-contents
   (package-refresh-contents))

                                          ; Initialize use-package on non-Linux platforms

  (unless (package-installed-p 'use-package)
     (package-install 'use-package))

  (require 'use-package)
  (setq use-package-always-ensure t)



#+end_src

#+RESULTS:
: t

* Mail with mu4e
** Config
#+BEGIN_SRC emacs-lisp
(use-package mu4e
   :ensure nil
   ;; :load-path "/usr/share/emacs/site-lisp/mu4e/"
   :config
   ;; this si set to t to avoid mail syncing issues
   (setq mu4e-change-filenames-when-moving t)
   ;; refresh mail using isync every 10 minutes
   (setq mu4e-update-interval (* 10 60))
   (setq mu4e-get-mail-command "mbsync -a")
   (setq mu4e-maildir "~/Mail")

   (setq mu4e-drafts-folder "/'[Gmail]'.Drafts")
   (setq mu4e-sent-folder "/[Gmail].Sent Mail")
   (setq mu4e-refile-folder "/[Gmail].All Mail")
   (setq mu4e-trash-folder "/[Gmail].Trash")

   (setq mu4e-maildir-shortcuts
   '(("/Inbox"                   . ?i)
     ("/[Gmail].Sent Mail"       . ?s)
     ("/[Gmail].Trash"           . ?t)
     ("/[Gmail].Drafts"          . ?d)
     ("/[Gmail].All Mail"        . ?a))))
   
#+END_SRC

#+RESULTS:
: t

#+RESULTS:mu
: t
** Hotkeys
| Key | Command                             | Description                                    |
| --  | -------------------                 | ---------------------------------------------- |
|     | *Movement*                            |                                                |
|     | ---                                 |                                                |
| n   | next-line                           | moves to next line                             |
| p   | prev-line                           | moves to prev line                             |
| [   | mu4e-headers-prev-unread            | moves to prev unread message                   |
| ]   | mu4e-headers-next-unread            | moves to next unread message                   |
| j   | mu4e-headers-jump-to-mail-dir       | Jump to another mail directory                 |
|     |                                     |                                                |
|     | *Toggles*                             |                                                |
| P   | mu4e-headers-toggle-threading       | Toggles threaded message display               |
| W   | mu4e-headers-toggle-include-related | Toggles related message display                |
|     |                                     |                                                |
|     | *Marking*                             |                                                |
| d   | mu4e-headers-mark-for-trash         | Marks message for deletion                     |
| m   | mu4e-headers-mark-for-move          | Marks message for move to folder               |
| +   | mu4e-headers-mark-for-flag          | Marks message for flagging                     |
| -   | mu4e-headers-mark-for-unflag        | Marks smessage for unflagging                  |
| %   | mu4e-headers-mark-for-pattern       | Marks based on a regex pattern                 |
| u   | mu4e-headers-mark-for-unmark        | Removes mark for message                       |
| U   | mu4e-mark-unmark-all                | Removes mark for all marks in view             |
| x   | mu4e-mark-execute-all               | Execute all marks in view                      |
|     |                                     |                                                |
|     | *Searching*                           |                                                |
| s   | mu4e-headers-search                 | Search all e-mails                             |
| S   | mu4e-headers-search-edit            | Edit current search (useful!!)                 |
| /   | mu4e-headers-search-narrow          | Narrow down the current results                |
| b   | mu4e-headers-search-bookmark        | Select a bookmark to search with               |
| B   | mu4e-headers-search-bookmark-edit   | Edit bookmark before search                    |
| g   | mu4e-rerun-search                   | Rerun current search                           |


* Basic UI Config
#+begin_src emacs-lisp
    (setq inhibit-startup-message t)

    (scroll-bar-mode -1) ;Disable visible scrollbar
    (tool-bar-mode -1)   ;DIsable toolbar
    (tooltip-mode -1)    ;disable tooltips11
    (set-fringe-mode 10) ;give some breathing room

    (menu-bar-mode -1)   ;disable menu bar

  ; setup the visible bell

    (setq visible-bell t)

  ;set font

    (set-face-attribute 'default nil :font "Fira Code Retina" :height 140)
  ; load theme note this passes an object denoted by a leading `
  

    (load-theme 'tango-dark)


#+end_src

#+RESULTS:
: t

** Themes
#+begin_src emacs-lisp
                                            ;set doom themes
      (use-package doom-themes
        :ensure t
        :config
        (load-theme 'doom-gruvbox t))
                                            ;use doom mode
      (use-package doom-modeline
        :ensure t
        :init (doom-modeline-mode 1)
        :config 
        (setq doom-modeline-height 15))

#+end_src

#+RESULTS:
: t

** DONE Transparency
CLOSED: [2022-06-01 Wed 13:18]
#+BEGIN_SRC emacs-lisp
 (set-frame-parameter (selected-frame) 'alpha '(85 . 50))
 (add-to-list 'default-frame-alist '(alpha . (85 . 50)))

 (defun toggle-transparency ()
   (interactive)
   (let ((alpha (frame-parameter nil 'alpha)))
     (set-frame-parameter
      nil 'alpha
      (if (eql (cond ((numberp alpha) alpha)
                     ((numberp (cdr alpha)) (cdr alpha))
                     ;; Also handle undocumented (<active> <inactive>) form.
                     ((numberp (cadr alpha)) (cadr alpha)))
               100)
          '(85 . 50) '(100 . 100)))))
 (global-set-key (kbd "C-c x t") 'toggle-transparency)
#+END_SRC

#+RESULTS:
: toggle-transparency

* Emacs Usability
** Helpful
#+begin_src emacs-lisp
  (use-package helpful
    :custom
    (counsel-describe-function-function #'helpful-callable)
    (counsel-describe-variable-function #'helpful-variable)
    :bind
    ([remap describe-function] . counsel-describe-function)
    ([remap describe-command] . helpful-command)
    ([remap describe-variable] . counsel-describe-variable)
    ([remap describe-key] . helpful-key))
#+end_src
** Whichkey
#+begin_src emacs-lisp
(use-package which-key
  :init (which-key-mode)
  :diminish (which-key-mode)
  :config
  (setq which-key-idle-delay 1))

#+end_src
** Completion
#+begin_src emacs-lisp
  
;;           (use-package counsel
;;             :bind (("M-x" . counsel-M-x)
;;                    ("C-x b" . counsel-ibuffer)


;; story)))

  ;;        (use-package ivy-richt
    ;;        :init
      ;;      (ivy-rich-mode 1))

          (use-package vertico
            :ensure t
            :custom
            (vertico-cycle t)
            :init
            (vertico-mode))
  (use-package savehist
    :init
    (savehist-mode))

  (use-package marginalia
    :after vertico
    :ensure t
    :custom
    (marginalia-annotators '(marginalia-annotators-heavy marginalia-annotators-light nil))
    :init
    (marginalia-mode))



#+end_src

#+RESULTS:

** Yas Mode
#+BEGIN_SRC emacs-lisp

(yas-global-mode 1)
#+END_SRC



* Window Control
#+BEGIN_SRC emacs-lisp
(use-package ace-window)



(custom-set-faces
 '(aw-leading-char-face
   ((t (:inherit ace-jump-face-foreground :height 3.0)))))

(defun scroll-down-keep-cursor ()
    ;; Scroll the text one line down while keeping the cursor  
    (interactive) 

    (scroll-down 1))

(defun scroll-up-keep-cursor ()  
    ;; Scroll the text one line up while keeping the cursor   
    (interactive) 

    (scroll-up 1))

(global-set-key (kbd "<next>") 'scroll-down-keep-cursor)
(global-set-key (kbd "<prior>") 'scroll-up-keep-cursor)

(global-set-key (kbd "C-M-]") 'avy-goto-word-or-subword-1)
;; unbund c-] from abort-recursive-edit
(global-set-key (kbd "C-+") 'smartscan-symbol-go-backward)
(global-set-key (kbd "C-=") 'smartscan-symbol-go-forward)
(global-set-key (kbd "M-RET") 'counsel-ibuffer)



#+END_SRC

#+RESULTS:[]
: counsel-ibuffer

* Org Config Setup
** initial package setup
#+begin_src emacs-lisp
  ;;;;; Org mode setup ;;;;;

                                          ;require tempo

  (defun org-mode-setup()
    (org-indent-mode)
    (variable-pitch-mode 1)
    (auto-fill-mode 0)
    (visual-line-mode 1))


  (use-package org
    :hook (org-mode . org-mode-setup)
    :config
    (setq org-agenda-files
          '("~/Projects/emacsone/OrgFiles/tasks.org"
            "~/Projects/emacsone/OrgFiles/habits.org"))

    (setq org-agenda-start-with-log-mode t)
    (setq org-log-done 'time)
    (setq org-log-into-drawer t)
    (setq org-ellipsis " ▾"
          org-hide-emphasis-markers t)
    (setq org-capture-babel-evaluate t)
                                          ; org capture

    (setq org-capture-templates
          '(("t" "Tasks / Projects")
            ("tt" "Task" entry (file+olp "~/Projects/emacsone/OrgFiles/tasks.org" "Inbox")
             "* TODO %?\n %U\n %a\n %i" :empty-lines 1)
            ("ts" "Clockked Entry Subtask" entry (clock)
             "* TODO %?\n %U\n %a\n %i" :empty-lines 1)

            ("j" "Journal Entries")
            ("jj" "Journal" entry
             (file+olp+datetree "~/Projects/emacsone/OrgFiles/journal.org")
             "\n* %<%I:%M %p> - Journal :journal:\n\n%?\n\n"
             ;;
             :clock-in :clock-resume
             :empty-lines 1)
            ("jm" "Meeting" entry
             (file+olp+datetree "~/Projects/emacsone/OrgFiles/journal.org")
             "* %<%I:%M %P> - %a :meetings:\n\n%?\n\n"
             :clock-in :clock-resume
             :empty-lines 1)

            ("w" "Workflows")
            ("we" "Checking Email" entry (file+olp+datetree "~/Projects/emacsone/OrgFiles/journal.org")
             "* Checking Email :email:\n\n%?" :clockin :clock-resume :empty-lines 1)

            ("m" "Metrics Capture")

            ("mw" "Weight" table-line (file+headline "~/Projects/emacsone/OrgFiles/metrics.org" "Weight")
             "| %U | %^{Weight} | %^{Notes} |" :kill-buffer t))))

                                          ; hotkey bindings
    (define-key global-map (kbd "C-c o")
      (lambda () (interactive) (org-capture)))

    (define-key global-map (kbd "C-c j")
    (lambda () (interactive) (org-capture nil "jj")))

    (define-key global-map (kbd "C-c t")
    (lambda () (interactive) (org-capture nil "tt")))

    (global-set-key (kbd "C-c a") 'org-agenda)


                                          ; refile targets


    (setq org-refile-targets
          '(("archive.org" :maxlevel . 1)
            ("tasks.org" :maxlevel . 1)))
                                          ; load org habits
    (require 'org-habit)
     (add-to-list 'org-modules 'org-habit)
     (setq org-habit-graph-column 60)



  ;;;;; end org mode setup ;;;;; 

#+end_src

#+RESULTS:
: 60

** Font Configuration
#+begin_src emacs-lisp
    (dolist (face '((org-level-1 . 1.2)
                    (org-level-2 . 1.1)
                    (org-level-3 . 1.05)
                    (org-level-4 . 1.0)
                    (org-level-5 . 1.1)
                    (org-level-6 . 1.1)
                    (org-level-7 . 1.1)
                    (org-level-8 . 1.1)))
      (set-face-attribute (car face) nil :font "Cantarell" :weight 'regular :height (cdr face)))
                                            ; keep a few things fixed pitch as they should be for line ups

  (set-face-attribute 'org-block nil :foreground nil :inherit 'fixed-pitch)
    (set-face-attribute 'org-table nil  :inherit 'fixed-pitch)
    (set-face-attribute 'org-formula nil  :inherit 'fixed-pitch)
    (set-face-attribute 'org-code nil   :inherit '(shadow fixed-pitch))
  ;  (set-face-attribute 'org-indent nil :inherit '(org-hide fixed-pitch))
    (set-face-attribute 'org-verbatim nil :inherit '(shadow fixed-pitch))
    (set-face-attribute 'org-special-keyword nil :inherit '(font-lock-comment-face fixed-pitch))
    (set-face-attribute 'org-meta-line nil :inherit '(font-lock-comment-face fixed-pitch))
    (set-face-attribute 'org-checkbox nil :inherit 'fixed-pitch)

#+end_src
** bullets and dashes
#+begin_src emacs-lisp
(use-package org-bullets
  :after org
  :hook (org-mode . org-bullets-mode)
  :custom
  (org-bullets-bullet-list '("◉" "○" "●" "○" "●" "○" "●")))


					;replace dashes with dots

(font-lock-add-keywords 'org-mode
                         '(("^ *\\([-]\\) "
                             (0 (prog1 () (compose-region (match-beginning 1) (match-end 1) "•"))))))			   

#+end_src
** Structure Templates
#+begin_src emacs-lisp
    ;; This is needed as of Org 9.2
 ;  (require 'org-tempo)
  ;  (with-eval-after-load 'org-tempo
        (add-to-list 'org-structure-template-alist '("sh" . "src shell"))
       (add-to-list 'org-structure-template-alist '("el" . "src emacs-lisp")) 
        (add-to-list 'org-structure-template-alist '("py" . "src python"))


#+end_src
** Language Setup
#+begin_src emacs-lisp
  (org-babel-do-load-languages
   'org-babel-load-languages
   '((emacs-lisp .t )
     (python .t)))
  
#+end_src
** Auto-Tangle Config Files
#+begin_src emacs-lisp
    ;;auto tangle my emacs config file
  (defun emacsone/org-babel-tangle-config()
    (when (string-equal (buffer-file-name)
		        (expand-file-name "~/Projects/emacsone/OrgFiles/emacsconf.org"))
      ;; dynamic scoping
      (let ((org-confirm-babel-evaluate nil))
	(org-babel-tangle))))
    (add-hook 'org-mode-hook (lambda () (add-hook 'after-save-hook #'emacsone/org-babel-tangle-config)))
#+end_src
** Visual Fill Mode
#+begin_src emacs-lisp
    (defun org-mode-visual-fill()
      (setq visual-fill-column-width 150 visual-fill-column-center-text t)
      (visual-fill-column-mode 1))


    (use-package visual-fill-column
      :hook (org-mode . org-mode-visual-fill)) 

#+end_src
** Pomodoro
#+BEGIN_SRC emacs-lisp 

(setq org-clock-sound "~/Downloads/cheer.wav")
#+END_SRC

#+RESULTS:
: ~/Downloads/cheer.wav

* Org-Roam Setup
#+BEGIN_SRC emacs-lisp
  (use-package org-roam
    :ensure t
    :custom
    (org-roam-directory "~/RoamNotes")
    (org-roam-completion-everywhere t)

    :bind (("C-c n l" . org-roam-buffer-toggle)
           ("C-c n f" . org-roam-node-find)
           ("C-c n i" . org-roam-node-insert)
           ("C-c n c" . org-id-get-create)
           ("C-c n a" . org-roam-alias-add)
           ("C-c n r" . org-roam-alias-remove)
           :map org-mode-map
           ("C-M-i" . completion-at-point)
           ("C-c n b" . org-mark-ring-goto))
          :config
          (org-roam-setup)

    )

  (with-eval-after-load "org-roam" 
          (setq org-roam-capture-templates
                '(("d" "default" plain
                   "%?"
                   :if-new (file+head "%<%Y%m%d%H%M%S>-${slug}.org" "#+title: ${title}\n#+date: %U\n")
                   :unnarrowed t)
                ;; programming language
                ("l" "programming language" plain
                 "* Characteristics\n\n- Family: %?\n- Inspired by: \n\n* Reference:\n\n"
                 :if-new (file+head "%<%Y%m%d%H%M%S>-${slug}.org" "#+title: ${title}\n#+date: %U\n")
                 :unnarrowed t)
                ("b" "book notes" plain
                 "\n* Source\n\nAuthor: %^{Author}\nTitle: ${title}\nYear: %^{Year}\n\n* Summary\n\n%?"
                 :if-new (file+head "%<%Y%m%d%H%M%S>-${slug}.org" "#+title: ${title}\n#+date: %U\nest")
                 :unnarrowed t))))



  (use-package org-roam-ui
    :bind ("s-r" . org-roam-ui-open))


#+END_SRC

#+RESULTS:
: org-roam-ui-open


* IDE Setup
** To add

** Magit
#+begin_src emacs-lisp
(use-package magit
  :commands (magit-status magit-get-current-branch)
  :custom
  (magit-display-buffer-function #'magit-display-buffer-same-window-except-diff-v1))
(setq magit-clone-default-directory "~/Projects/")

#+end_src

#+RESULTS:
: ~/Projects/

** Git Gutter
#+BEGIN_SRC emacs-lisp
  (use-package git-gutter
    :hook (prog-mode . git-gutter-mode)
    :config
    (setq git-gutter:update-interval 0.02))
  (use-package git-gutter-fringe
    :config
    (define-fringe-bitmap 'git-gutter-fr:added [224] nil nil '(center repeated))
    (define-fringe-bitmap 'git-gutter-fr:modified [224] nil nil '(center repeated))
    (define-fringe-bitmap 'git-gutter-fr:deleted [128 192 224 240] nil nil 'bottom))

#+END_SRC

#+RESULTS:
: t

** Forge
#+begin_src emacs-lisp
(use-package forge)
#+end_src

** Git from Clipboard
#+begin_src emacs-lisp

(defun ar/git-clone-clipboard-url ()
  "Clone git URL in clipboard asynchronously and open in dired when finished."
  (interactive)
  (cl-assert (string-match-p "^\\(http\\|https\\|ssh\\)://" (current-kill 0)) nil "No URL in clipboard")
  (let* ((url (current-kill 0))
         (download-dir (expand-file-name "~/Downloads/"))
         (project-dir (concat (file-name-as-directory download-dir)
                              (file-name-base url)))
         (default-directory download-dir)
         (command (format "git clone %s" url))
         (buffer (generate-new-buffer (format "*%s*" command)))
         (proc))
    (when (file-exists-p project-dir)
      (if (y-or-n-p (format "%s exists. delete?" (file-name-base url)))
          (delete-directory project-dir t)
        (user-error "Bailed")))
    (switch-to-buffer buffer)
    (setq proc (start-process-shell-command (nth 0 (split-string command)) buffer command))
    (with-current-buffer buffer
      (setq default-directory download-dir)
      (shell-command-save-pos-or-erase)
      (require 'shell)
      (shell-mode)
      (view-mode +1))
    (set-process-sentinel proc (lambda (process state)
                                 (let ((output (with-current-buffer (process-buffer process)
                                                 (buffer-string))))
                                   (kill-buffer (process-buffer process))
                                   (if (= (process-exit-status process) 0)
                                       (progn
                                         (message "finished: %s" command)
                                         (dired project-dir))
                                     (user-error (format "%s\n%s" command output))))))
    (set-process-filter proc #'comintoutput-filter)))
#+end_src



** Projectile
#+begin_src emacs-lisp
(use-package projectile
  :diminish projectile-mode
  :config (projectile-mode)
  :custom ((projectile-completion-system 'ivy))
  :bind-keymap
  ("C-c p" . projectile-command-map)
  :init
  (when (file-directory-p "~/Projects/Code")
    (setq projectile-project-search-path '("~/Projects/Code")))
  (setq projectile-switch-project-action #'projectile-dired))

(use-package counsel-projectile
  :config (counsel-projectile-mode))

#+end_src
** Rainbow Deliminators
#+begin_src emacs-lisp
(use-package rainbow-delimiters
  :hook (prog-mode . rainbow-delimiters-mode))

#+end_src

#+RESULTS:
| rainbow-delimiters-mode |

** Electric Pair mode
#+BEGIN_SRC emacs-lisp
(add-hook 'prog-mode-hook 'electric-pair-mode)
(add-hook 'prog-mode-hook 'electric-indent-mode)
(global-set-key (kbd "C-c s (") 'electric-pair-mode)


#+END_SRC

#+RESULTS:
| electric-indent-mode | electric-pair-mode | my-display-numbers-hook | rainbow-delimiters-mode |
** Line Numbers
#+begin_src emacs-lisp
(setq display-line-numbers-type 'relative)

(defun my-display-numbers-hook ()
  (display-line-numbers-mode t)
  )
(add-hook 'prog-mode-hook 'my-display-numbers-hook)
(add-hook 'text-mode-hook 'my-display-numbers-hook)
(dolist (mode '(org-mode-hook))
  (add-hook mode (lambda () (display-line-numbers-mode 0))))
#+end_src

#+RESULTS:

** Commenting
#+begin_src emacs-lisp
  (use-package evil-nerd-commenter
    :bind ("M-;" . evilnc-comment-or-uncomment-lines))
#+end_src

** Mini-map
#+BEGIN_SRC emacs-lisp
(use-package minimap)

(setq minimap-window-location 1)

(global-set-key (kbd "C-c s m")  'minimap-mode)
#+END_SRC

#+RESULTS:
: minimap-mode

** Languages
*** HTML & CSS
Some possible html modes to look into:
http://xahlee.info/emacs/emacs/emacs_html.html
http://xahlee.info/emacs/emacs/xah-css-mode.html
**** web-mode
#+BEGIN_SRC emacs-lisp
(use-package web-mode)
(setq web-mode-enable-current-column-highlight t)
(setq web-mode-enable-current-element-highlight t)
; hook into web mode for file types
(add-to-list 'auto-mode-alist '("\\.phtml\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.tpl\\.php\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.[agj]sp\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.as[cp]x\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.erb\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.mustache\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.djhtml\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.html?\\'" . web-mode))
;;using rsjx mode
;;(add-to-list 'auto-mode-alist '("\\.js\\'" . web-mode))
;(add-to-list 'auto-mode-alist '("\\.css?\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.xml\\'" . web-mode))
;; using rsjx mode
;;(add-to-list 'auto-mode-alist '("\\.jsx\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.ts\\'" . web-mode))

; set company completions vocab to css and html

(setq web-mode-enable-engine-detection t)

#+END_SRC

#+RESULTS:
: t
**** emmet-mode
#+BEGIN_SRC emacs-lisp
(use-package emmet-mode
:bind 
("M-n" . emmet-next-edit-point)
("M-p" . emmet-prev-edit-point))
; use emmet in all web-mode docs
(add-hook 'web-mode-hook 'emmet-mode)
(add-hook 'css-mode-hook 'emmet-mode)

; enable mode switching between css and java
(add-hook 'web-mode-before-auto-complete-hooks
    '(lambda ()
     (let ((web-mode-cur-language
  	    (web-mode-language-at-pos)))
               (if (string= web-mode-cur-language "php")
    	   (yas-activate-extra-mode 'php-mode)
      	 (yas-deactivate-extra-mode 'php-mode))
               (if (string= web-mode-cur-language "css")
    	   (setq emmet-use-css-transform t)
      	 (setq emmet-use-css-transform nil)))))




#+END_SRC

#+RESULTS:
| lambda | nil | (let ((web-mode-cur-language (web-mode-language-at-pos))) (if (string= web-mode-cur-language php) (yas-activate-extra-mode (quote php-mode)) (yas-deactivate-extra-mode (quote php-mode))) (if (string= web-mode-cur-language css) (setq emmet-use-css-transform t) (setq emmet-use-css-transform nil))) |
**** css-mode
#+BEGIN_SRC emacs-lisp

#+END_SRC
*** Language Server
#+begin_src emacs-lisp
  ; breadcrumb setup

  (defun lsp-mode-setup ()
    (setq lsp-headerline-breadcrumb-segments '(path-up-to-project file symbols))
    (lsp-headerline-breadcrumb-mode))

    (use-package lsp-mode
      :commands (lsp lsp-deffered)
      :hook (lsp-mode . lsp-mode-setup)
      :init
      (setq lsp-keymap-prefix "C-c l")
      :config
      (lsp-enable-which-key-integration t))
    ; turn on lsp ui

    (use-package lsp-ui
      :after lsp
      :hook (lsp-mode . lsp-ui-mode)
      :config
      (setq lsp-ui-doc-position 'bottom))

    (use-package lsp-treemacs
      :after lsp)


#+end_src

#+RESULTS:
*** TypeScript
#+begin_src emacs-lisp
  (use-package typescript-mode
    :mode "\\.ts\\'"
    :hook (typescript-mode . lsp-deferred)
    :config
    (setq typescript-indent-level 2))
#+end_src
*** Javascript
Following setup from here: https://www.chadstovern.com/javascript-in-emacs-revisited/
#+BEGIN_SRC emacs-lisp
  (use-package rjsx-mode
    :mode ("\\.js\\'"
           "\\.jsx\\'")
    :config
    (setq js2-mode-show-parse-errors nil
          js2-mode-show-strict-warnings nil
          js2-basic-offset 2
          js-indent-level 2)
    (setq-local flycheck-disabled-checkers (cl-union flycheck-disabled-checkers
                                                     '(javascript-jshint))) ; jshint doesn't work for JSX
    (electric-pair-mode 1))

  (use-package add-node-modules-path
    :defer t
    :hook (((js2-mode rjsx-mode) . add-node-modules-path)))

  ;; prettify

  (use-package prettier-js
    :defer t
    :diminish prettier-js-mode
    :hook (((js2-mode rjsx-mode) . prettier-js-mode)))

  ;; setup lsp mode
  (use-package lsp-mode
    :defer t
    :diminish lsp-mode
    :hook (((js2-mode rjsx-mode) . lsp))
    :commands lsp
    :config
    (setq lsp-auto-configure t
          lsp-auto-guess-root t
          ;; don't set flymake or lsp-ui so the default linter doesn't get trampled
          lsp-diagnostic-package :none))



  (use-package lsp-ui
    :defer t
    :config
    (setq lsp-ui-sideline-enable t
          ;; disable flycheck setup so default linter isn't trampled
          lsp-ui-flycheck-enable nil
          lsp-ui-sideline-show-symbol nil
          lsp-ui-sideline-show-hover nil
          lsp-ui-sideline-show-code-actions nil
          lsp-ui-peek-enable nil
          lsp-ui-imenu-enable nil
          lsp-ui-doc-enable nil))


  (defun my-js-comint-keys ()
    "My Keys for sending to the js-comint repl"
    (interactive)
    (local-set-key (kbd "C-x C-e") 'js-send-last-sexp)
    (local-set-key (kbd"C-c b") 'js-send-buffer)
    (local-set-key (kbd"C-c r") 'js-send-region)
    (local-set-key (kbd"C-c C-r") 'js-send-region-and-go))




  (require 'js-comint)
  (setq inferior-js-program-command "node --interactive")
  (setenv "NODE_NO_READLINE" "1")
  (add-hook 'rjsx-mode-hook 'my-js-comint-keys)


  (with-eval-after-load 'flycheck
    (flycheck-add-next-checker 'javascript-eslint '(t . javascript-jscs)))





#+END_SRC

#+RESULTS:
*** 
** Better Completions
#+begin_src emacs-lisp
      (use-package company
      :after lsp-mode
      :hook ((lsp-mode web-mode) . company-mode)
      :bind (:map company-active-map
                  ( "<tab>" . company-complete-selection))
      (:map lsp-mode-map
            ("<tab>" . company-indent-or-complete-common)) 
  )
      (setq company-minimum-prefix-length 2)



    (use-package company-web
  :after company)


  (defun my-web-mode-hook ()
    (set (make-local-variable 'company-backends) '(company-css company-web-html company-yasnippet company-files)))  

  (add-hook 'web-mode-hook 'my-web-mode-hook)

  ;; Company mode for yas
  (global-set-key (kbd "<C-tab>") 'company-yasnippet)
    ;  (use-ackage company-box
     ;   :hook (company-mode . company-box-mode))
#+end_src

#+RESULTS:
: company-yasnippet





** Debugging
Dap mode here: https://www.youtube.com/watch?v=0bilcQVSlbM
* Macros and rebind




** next-tag - "C-x t" - Move inside the next tag set in web-mode
#+BEGIN_SRC emacs-lisp
(defun next-tag()
  (interactive)
    (web-mode-element-next)
    (web-mode-tag-end))



(global-set-key  (kbd "C-x t") 'next-tag)

;; set ctrl z to undo
(global-set-key (kbd "C-z") 'undo)

#+END_SRC

#+RESULTS:
: undo

#+RESULTS::
: next-tag
** Window Movement
#+BEGIN_SRC emacs-lisp
(global-set-key (kbd "M-+") 'other-window)
(global-set-key (kbd "M-[") 'ace-window)
(global-set-key (kbd "M-]") 'treemacs-select-window)
(global-set-key [(meta left)] 'windmove-left)
(global-set-key [(meta right)] 'windmove-right)
(global-set-key [(meta up)] 'windmove-up)
(global-set-key [(meta down)] 'windmove-down)
(global-set-key (kbd "C-c s t") 'treemacs)

#+END_SRC

#+RESULTS:
: treemacs

** TODO Cursor Movement
#+BEGIN_SRC emacs-lisp
    (defun insert-line-above-and-go ()
      ;;insert a line above the current one and move the cursor there
      (interactive)
      (previous-line nil)
      (move-end-of-line nil)
      (electric-newline-and-maybe-indent)
      (indent-relative-first-indent-point))

    (global-set-key (kbd "M-o") 'insert-line-above-and-go)

    ;;
    ;

    ; ;

    ;; move C-j to C-; indent-new-comment-line
    (global-set-key (kbd "C-;") 'indent-new-comment-line)

    (global-set-key (kbd "H-]") 'xref-find-references)
    (global-set-key (kbd "H-[") 'xref-go-back)
    (global-set-key (kbd "H-g") 'goto-line)

    (defun wrap-sexp-backward-with-parenthesis()
      (interactive)
      (backward-sexp)
      (mark-sexp) 
      (insert-parentheses))

      (global-set-key (kbd "C-(") 'wrap-sexp-backward-with-parenthesis)


    (global-set-key (kbd "s-a") 'ace-jump-word-mode)


    (global-set-key (kbd "M-m")  (kmacro-lambda-form [?\C-u ?\C-x ?\C-x] 0 "%d"))



#+End_SRC

#+RESULTS:
| lambda | (&optional arg) | Keyboard macro. | (interactive p) | (kmacro-exec-ring-item '([21 24 24] 0 %d) arg) |
** Delete at cursor
#+BEGIN_SRC emacs-lisp
(defun kill-word-at-point()
  (interactive)
  (kill-word 1)
  (backward-kill-word 1))

  (global-set-key (kbd "M-DEL") 'kill-word-at-point)

(defun kill-line-at-point()
  (interactive)
  (back-to-indentation)
  (kill-line))
  
  (global-set-key (kbd "s-l") 'kill-line-at-point)


#+END_SRC

#+RESULTS:
: kill-line-at-point

#+-
**  Duplicate Lines
#+BEGIN_SRC emacs-lisp
  (defun duplicate-current-line()
    "Duplicates the entire line under point. Repetable with 'd' "
    (interactive)
    (back-to-indentation)
    (kill-line)
    (yank)
    (newline)
    (indent-for-tab-command)
    (yank)
    (set-temporary-overlay-map
      (let ((map (make-sparse-keymap)))
        (define-key map (kbd "d") 'duplicate-current-line)
        map)))

  (defun duplicate-line-up-to-point()
   "Duplicates a line from start of indentation up to point. May be repeated with single 'd' presses."
    (interactive)
    (set-mark-command nil)
    (back-to-indentation)
    (kill-ring-save (region-beginning) (region-end))
    (end-of-line)
    (newline)
  ;; example of single key repeat functionality
    (yank)
    (set-temporary-overlay-map
      (let ((map (make-sparse-keymap)))
        (define-key map (kbd "d") 'duplicate-line-up-to-point)
        map)))


  (global-set-key (kbd "H-s-d") 'duplicate-current-line
                  )
  (global-set-key (kbd "H-d") 'duplicate-line-up-to-point)







  (progn
    ;; some Hyper keys to insert Unicode chars
    (define-key key-translation-map (kbd "H-3") (kbd "•")) ; bullet
    (define-key key-translation-map (kbd "H-4") (kbd "◇")) ; white diamond
    (define-key key-translation-map (kbd "H-5") (kbd "†")) ; dagger
    )

#+END_SRC

#+RESULTS:
: [8224]
** Register manipulation
#+BEGIN_SRC emacs-lisp
(global-set-key (kbd "s-s") 'point-to-register)
(global-set-key (kbd "s-j") 'jump-to-register)
(global-set-key (kbd "H-s") 'bookmark-set)
(global-set-key (kbd "H-j") 'bookmark-jump)



#+END_SRC

#+RESULTS:
: bookmark-jump
* dired
** Hotkeys to remember
- m: mark files
- u: umark files
- U: unmark all files
- % -> m: reg expession mark
- * : mark by type
- ( : expand or collapse details
- k : kill marked files ( will kill from view but not delete)
- g : reload buffer
- * t: invert marked files
- S : create sym link
** config
#+BEGIN_SRC emacs-lisp
; list directories first
(setq dired-listing-switches "-agho --group-directories-first")
(setq dired-dwim-target t)


#+END_SRC
#+RESULTS:
: t
** SIngle Dired Buffer
#+BEGIN_SRC emacs-lisp
(use-package dired-single)
#+END_SRC
** Icons
#+BEGIN_SRC emacs-lisp
(use-package all-the-icons-dired
:hook (dired-mode . all-the-icons-dired-mode))
#+END_SRC

#+RESULTS:
| all-the-icons-dired-mode | dired-hide-dotfiles-mode | dired-hide-dotfiles | doom-modeline-set-project-modeline |
** Dired-Open
#+BEGIN_SRC emacs-lisp

;(use-package dired-open) look into this package if you end up needing it.

#+END_SRC
** Hide Dot Files
- hotkey: . (dot)
#+BEGIN_SRC emacs-lisp
(defun my-dired-mode-hook ()
  "My `dired' mode hook."
  ;; To hide dot-files by default
  (dired-hide-dotfiles-mode))

;; To toggle hiding
(define-key dired-mode-map "." #'dired-hide-dotfiles-mode)
(add-hook 'dired-mode-hook #'my-dired-mode-hook)

#+END_SRC

#+RESULTS:
| my-dired-mode-hook | all-the-icons-dired-mode | dired-hide-dotfiles-mode | dired-hide-dotfiles | doom-modeline-set-project-modeline |
* Dashboard
#+BEGIN_SRC emacs-lisp
(use-package dashboard
:ensure t
:config
(dashboard-setup-startup-hook))

#+END_SRC

#+RESULTS:
: t

* Testing
#+BEGIN_SRC emacs-lisp

;;set load path for person elisp
(add-to-list 'load-path "~/.emacs.d/lisp")

;; load the package iy-go-to-char
(load "iy-go-to-char")
;; rebind back-to-indentation to "M-i" NOTE this unbinds!! tab-to-tab-stop
(global-set-key (kbd "M-i") 'back-to-indentation)
;; rebind "M-m" iy-go-to-char
(global-set-key (kbd "s-n") 'iy-go-to-char)
;;unbind C-m from return  
(global-set-key (kbd "s-h") 'iy-go-up-to-char)
(global-set-key (kbd "s-b") 'iy-go-to-char-backward)
(global-set-key (kbd "s-g") 'iy-go-up-to-char-backward)
#+END_SRC

#+RESULTS:
: iy-go-up-to-char-backward

 
